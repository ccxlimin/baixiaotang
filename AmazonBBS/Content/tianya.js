var skin_resource_url = "http://static.tianyaui.com/global/my/web/static",
__skin = [{
    id: 119,
    name: "白云蓝天",
    hue: "hue-blue"
},
{
    id: 117,
    name: "黑白画映",
    hue: "hue-gray"
},
{
    id: 116,
    name: "画座山给你",
    hue: "hue-green"
},
{
    id: 114,
    name: "天涯十五周年",
    hue: "hue-blue"
},
{
    id: 113,
    name: "蓝天下的草帽",
    hue: "hue-gray"
},
{
    id: 112,
    name: "水天一色",
    hue: "hue-gray"
},
{
    id: 111,
    name: "雾的都市",
    hue: "hue-gray"
},
{
    id: 110,
    name: "相思红豆",
    hue: "hue-gray"
},
{
    id: 109,
    name: "辽阔草原",
    hue: "hue-gray"
},
{
    id: 108,
    name: "冷酷的面庞",
    hue: "hue-gray"
},
{
    id: 107,
    name: "星空",
    hue: "hue-gray"
},
{
    id: 106,
    name: "极夜下的欢舞",
    hue: "hue-gray"
},
{
    id: 105,
    name: "摩天轮",
    hue: "hue-gray"
},
{
    id: 104,
    name: "夕阳下的缭绕",
    hue: "hue-gray"
},
{
    id: 103,
    name: "魅力hold住",
    hue: "hue-purple"
},
{
    id: 102,
    name: "烟雾弥漫",
    hue: "hue-gray"
},
{
    id: 101,
    name: "绚丽光影",
    hue: "hue-red"
},
{
    id: 100,
    name: "想唱就唱",
    hue: "hue-yellow"
},
{
    id: 99,
    name: "线条之舞",
    hue: "hue-red"
},
{
    id: 98,
    name: "夏",
    hue: "hue-green"
},
{
    id: 97,
    name: "雾中的城堡",
    hue: "hue-gray"
},
{
    id: 96,
    name: "外太空",
    hue: "hue-purple"
},
{
    id: 95,
    name: "藤蔓",
    hue: "hue-red"
},
{
    id: 94,
    name: "太阳花",
    hue: "hue-blue"
},
{
    id: 93,
    name: "秋天的剪影",
    hue: "hue-blue"
},
{
    id: 92,
    name: "蒲公英",
    hue: "hue-green"
},
{
    id: 91,
    name: "迷失",
    hue: "hue-gray"
},
{
    id: 90,
    name: "萌芽",
    hue: "hue-blue"
},
{
    id: 89,
    name: "咖啡时刻",
    hue: "hue-blue"
},
{
    id: 88,
    name: "简约",
    hue: "hue-gray"
},
{
    id: 87,
    name: "激光绚烂",
    hue: "hue-red"
},
{
    id: 86,
    name: "灰色线条",
    hue: "hue-gray"
},
{
    id: 85,
    name: "欢乐时光",
    hue: "hue-blue"
},
{
    id: 84,
    name: "春意盎然",
    hue: "hue-green"
},
{
    id: 83,
    name: "初冬",
    hue: "hue-yellow"
},
{
    id: 82,
    name: "抽象",
    hue: "hue-blue"
},
{
    id: 77,
    name: "红色圣诞",
    hue: "hue-green"
},
{
    id: 75,
    name: "绿色圣诞",
    hue: "hue-blue"
},
{
    id: 74,
    name: "童年记忆",
    hue: "hue-purple"
},
{
    id: 73,
    name: "彩色之手",
    hue: "hue-yellow"
},
{
    id: 72,
    name: "幸福小屋",
    hue: "hue-gray"
},
{
    id: 71,
    name: "粉色点点",
    hue: "hue-red"
},
{
    id: 70,
    name: "风花雪兔",
    hue: "hue-blue"
},
{
    id: 69,
    name: "鱼的世界",
    hue: "hue-blue"
},
{
    id: 68,
    name: "遥望雪山",
    hue: "hue-gray"
},
{
    id: 67,
    name: "快乐火车",
    hue: "hue-blue"
},
{
    id: 66,
    name: "炫动火花",
    hue: "hue-purple"
},
{
    id: 65,
    name: "黑风谷",
    hue: "hue-blue"
},
{
    id: 64,
    name: "苹果乐园",
    hue: "hue-blue"
},
{
    id: 63,
    name: "守候",
    hue: "hue-yellow"
},
{
    id: 62,
    name: "舞动奇迹",
    hue: "hue-purple"
},
{
    id: 61,
    name: "绿色果树",
    hue: "hue-blue"
},
{
    id: 60,
    name: "那年.那时",
    hue: "hue-yellow"
},
{
    id: 59,
    name: "灰色冰肌",
    hue: "hue-gray"
},
{
    id: 58,
    name: "少女情怀",
    hue: "hue-blue"
},
{
    id: 57,
    name: "小花猫",
    hue: "hue-red"
},
{
    id: 56,
    name: "暮色灯谜",
    hue: "hue-blue"
},
{
    id: 55,
    name: "无法取代",
    hue: "hue-yellow"
},
{
    id: 54,
    name: "我是NO.1",
    hue: "hue-green"
},
{
    id: 53,
    name: "极速光线",
    hue: "hue-blue"
},
{
    id: 52,
    name: "爱的等待",
    hue: "hue-gray"
},
{
    id: 51,
    name: "安静的灵魂",
    hue: "hue-gray"
},
{
    id: 50,
    name: "欧洲花藤",
    hue: "hue-blue"
},
{
    id: 49,
    name: "人体色彩",
    hue: "hue-purple"
},
{
    id: 48,
    name: "我住月球",
    hue: "hue-blue"
},
{
    id: 47,
    name: "圣女果",
    hue: "hue-purple"
},
{
    id: 46,
    name: "生命挑战",
    hue: "hue-gray"
},
{
    id: 31,
    name: "蓝帅",
    hue: "hue-gray"
},
{
    id: 30,
    name: "爱情小象",
    hue: "hue-yellow"
},
{
    id: 29,
    name: "水墨小人",
    hue: "hue-gray"
},
{
    id: 28,
    name: "暴力使者",
    hue: "hue-gray"
},
{
    id: 27,
    name: "钢铁战士",
    hue: "hue-gray"
},
{
    id: 26,
    name: "童话世界",
    hue: "hue-green"
},
{
    id: 25,
    name: "蓝色幻想",
    hue: "hue-blue"
},
{
    id: 24,
    name: "空中飞鱼",
    hue: "hue-purple"
},
{
    id: 23,
    name: "飞舞蜻蜓",
    hue: "hue-yellow"
},
{
    id: 22,
    name: "彩色气球",
    hue: "hue-blue"
},
{
    id: 21,
    name: "幻彩空间",
    hue: "hue-purple"
},
{
    id: 20,
    name: "秋色剪影",
    hue: "hue-yellow"
},
{
    id: 19,
    name: "爱心大脸",
    hue: "hue-red"
},
{
    id: 18,
    name: "灰色经典",
    hue: "hue-gray"
},
{
    id: 16,
    name: "绿色经典",
    hue: "hue-green"
},
{
    id: 15,
    name: "黄色经典",
    hue: "hue-yellow"
},
{
    id: 14,
    name: "紫色经典",
    hue: "hue-purple"
},
{
    id: 13,
    name: "粉色经典",
    hue: "hue-red"
},
{
    id: 0,
    name: "蓝色经典",
    hue: "hue-blue"
}],
__headPic = [{
    id: 13,
    name: "无"
},
{
    id: 12,
    name: "天涯十五周年"
},
{
    id: 11,
    name: "秋寒花正黄"
},
{
    id: 10,
    name: "栈桥下的红雨"
},
{
    id: 9,
    name: "小憩余晖下"
},
{
    id: 8,
    name: "书香满屋"
},
{
    id: 7,
    name: "花开正浓"
},
{
    id: 6,
    name: "baby和她的小熊"
},
{
    id: 5,
    name: "雄鹰展翅"
},
{
    id: 4,
    name: "新生"
},
{
    id: 3,
    name: "撑起一把小红伞"
},
{
    id: 2,
    name: "蓝天下的暮色"
},
{
    id: 1,
    name: "明月当空照"
},
{
    id: 0,
    name: "快乐天涯er"
}];
jQuery(function () {
    var e = {
        skinWin: null,
        oldVal: {
            id: 119,
            hue: "hue-blue"
        },
        newVal: null,
        oldHeadId: 13,
        newHeadId: null,
        init: function () {
            this.setSkin(),
            this.setHeadPic(),
            this.bindEvent()
        },
        bindEvent: function () {
            var e = this;
            jQuery("#skinCornerBox").click(function (t) {
                t.preventDefault(),
                e.popSkinWin()
            })
        },
        setSkin: function (e, t) {
            var i = __skin,
            a = jQuery("#huebox").attr("class");
            if (e) {
                if (this.newVal = {
                    id: e,
                    hue: t
                },
                this.newVal) {
                    var n = ["skin-c" + this.newVal.id, this.newVal.hue].join(" ");
                    jQuery("#huebox").css("background-image", "url(" + skin_resource_url + "/skin/" + this.newVal.id + ".jpg)").attr("class", n)
                }
            } else if (a && /skin-c(\d+)/.exec(a)) {
                e = RegExp.$1;
                for (var o = -1; i[++o];) if (i[o].id == e) {
                    this.newVal = {
                        id: e,
                        hue: i[o].hue || ""
                    },
                    this.oldVal = {},
                    jQuery.extend(this.oldVal, this.newVal);
                    break
                }
            }
        },
        setHeadPic: function (e) {
            return this.oldHeadId = jQuery("#huebox").attr("_head"),
            e ? (this.newHeadId = e, void (13 != this.newHeadId ? jQuery("#hd").css("background-image", "url(" + skin_resource_url + "/skin/banner/" + this.newHeadId + ".jpg)") : jQuery("#hd").css("background-image", ""))) : void (this.newHeadId = this.oldHeadId)
        },
        createSkinList: function (e) {
            var t = __skin,
            i = t.length,
            a = skin_resource_url + "/skin/skins_thumb/";
            e = e || 1;
            var n = 10 * e - 10,
            o = 10 * e > i ? i : 10 * e,
            s = [];
            s.push('<ul class="clearfix">');
            for (var r = n; o > r; r++) {
                var d = t[r];
                s.push("<li " + (d.id == this.oldVal.id ? ' class="on"' : "") + '><img class="pic" src="' + a + d.id + '.jpg" _data="' + d.id + "," + (d.hue || "") + '" alt="' + d.name + '" title="' + d.name + '" /><p>' + d.name + "</p></li>")
            }
            return s.push("</ul>"),
            s.join("")
        },
        createHeadPicList: function (e) {
            var t = __headPic,
            i = 4,
            a = t.length,
            n = skin_resource_url + "/skin/skins_thumb/banner/";
            e = e || 1;
            var o = i * e - i,
            s = i * e > a ? a : i * e,
            r = [];
            r.push('<ul class="clearfix">');
            for (var d = o; s > d; d++) {
                var l = t[d];
                r.push("<li " + (l.id == this.oldHeadId ? ' class="on"' : "") + '><img class="pic" src="' + n + l.id + '.jpg" _data="' + l.id + '" alt="' + l.name + '" title="' + l.name + '" /><p>' + l.name + "</p></li>")
            }
            return r.push("</ul>"),
            r.join("")
        },
        crtPager: function (e, t, i, a, n, o) {
            var s = this;
            TY.loader("TY.view.page",
            function () {
                new TY.view.page({
                    el: jQuery("#" + a).children(".pager"),
                    page: e,
                    total: t.length,
                    showNum: i,
                    pageTagNum: 5,
                    isShowCount: !0,
                    isShowExtra: !0,
                    changeList: function (e) {
                        s.onPageChange(e, t, i, a, n, o)
                    }
                })
            })
        },
        onPageChange: function (e, t, i, a, n, o) {
            this.crtPager(e, t, i, a, n, o),
            jQuery("#" + n).html(o.call(this, e))
        },
        createSkinPager: function () {
            var e = this;
            this.crtPager(1, __skin, 10, "setSkin_content", "setSkinBox", e.createSkinList)
        },
        createHeadPicPager: function () {
            var e = this;
            this.crtPager(1, __headPic, 4, "setHead_content", "setHeadPicBox", e.createHeadPicList)
        },
        popSkinWin: function () {
            if (!this.skinWin) {
                var e = this;
                this.skinWin = new TY.ui.pop({
                    headTxt: "皮肤选择",
                    type: "confirm",
                    body: '<div id="skin_ctrl_container">   <h2 class="tabs-nav clearfix"><a href="javascript:void(0);" _tabname="setSkin_content">选择皮肤</a><a href="javascript:void(0);" _tabname="setHead_content">选择头图</a></h2>   <div class="tabs-content-wrap">       <div class="tabs-content" id="setSkin_content">           <div class="skin_box clearfix" id="setSkinBox"></div><div class="pager"></div>       </div>       <div class="tabs-content" id="setHead_content">           <div class="head_pic_box clearfix" id="setHeadPicBox"></div><div class="pager"></div>       </div>   </div></div>',
                    yesTxt: "保存皮肤",
                    yesHandler: function () {
                        jQuery.extend(e.oldVal, e.newVal),
                        e.oldHeadId = e.newHeadId,
                        jQuery.get(iceURL, {
                            method: "userColor.ice.set",
                            "params.picId": e.newHeadId,
                            "params.colorId": e.newVal.id
                        }),
                        e.skinWin = null
                    },
                    closeHandler: function () {
                        e.oldVal.id != e.newVal.id && e.setSkin(e.oldVal.id, e.oldVal.hue),
                        e.oldHeadId != e.newHeadId && e.setHeadPic(e.oldHeadId),
                        e.skinWin = null
                    },
                    cancelHandler: function () {
                        e.oldVal.id != e.newVal.id && e.setSkin(e.oldVal.id, e.oldVal.hue),
                        e.oldHeadId != e.newHeadId && e.setHeadPic(e.oldHeadId),
                        e.skinWin = null
                    },
                    isMod: !1
                }),
                jQuery("#setSkinBox").html(this.createSkinList(1)),
                this.createSkinPager(1),
                jQuery("#setSkinBox").delegate(".pic", "click",
                function () {
                    var t = jQuery(this).parent("li");
                    t.siblings("li").removeClass("on"),
                    t.addClass("on");
                    var i = jQuery(this).attr("_data").split(",");
                    e.setSkin(i[0], i[1])
                }),
                jQuery("#setHeadPicBox").html(this.createHeadPicList(1)),
                this.createHeadPicPager(1),
                jQuery("#setHeadPicBox").delegate(".pic", "click",
                function () {
                    var t = jQuery(this),
                    i = t.parent("li");
                    i.siblings("li").removeClass("on"),
                    i.addClass("on");
                    var a = t.attr("_data");
                    t.closest("#setSkinBox").size() > 0 ? (a = a.split(","), e.setSkin(a[0], a[1])) : e.setHeadPic(a)
                });
                var t = jQuery("#skin_ctrl_container"),
                i = t.find(".tabs-nav a");
                t.delegate(".tabs-nav a", "click",
                function (e) {
                    var i = t.find(".curr"),
                    a = jQuery(e.currentTarget);
                    i.removeClass("curr"),
                    jQuery("#" + i.attr("_tabname")).hide(),
                    a.addClass("curr"),
                    jQuery("#" + a.attr("_tabname")).show()
                }),
                i.first().trigger("click")
            }
        }
    },
    t = {
        listen: function (e) {
            var t = this;
            e.delegate(".addtoblack", "click",
            function (e) {
                return __global.isOnline() ? (e.preventDefault(), void t.addToBlack(jQuery(this))) : void TY.loginAction()
            }),
            e.delegate(".delfromblack", "click",
            function (e) {
                e.preventDefault(),
                t.delFromBlack(jQuery(this))
            })
        },
        addToBlack: function (e) {
            var t = ['<div style="width:300px;height:50px;">', '<h3 style="text-align:center">确认将【' + oHomeInfo.userName + "】拉入黑名单？</h3>", "<p>将TA拉黑以后，你们的好友关系和关注关系将自动解除。对方将无法添加你为好友或者是关注你，也不能再给你发@信息，短消息，以及禁止对方给你的随记进行评论。</p>", "</div>"].join("");
            new TY.ui.pop({
                headTxt: "提示",
                type: "confirm",
                body: t,
                yesHandler: function () {
                    jQuery.ajax({
                        url: iceURL,
                        data: {
                            method: "userBlack.ice.add",
                            "params.blackUserId": e.attr("_data")
                        },
                        type: "POST",
                        dataType: "json",
                        cache: !1,
                        success: function (e) {
                            e && 1 == e.success ? TY.loader("Qing.ui.tips",
                            function () {
                                new TY.ui.tips({
                                    type: "success",
                                    msg: "已将用户拉入黑名单。",
                                    position: "midCenter",
                                    time: 3e3,
                                    callback: function () {
                                        location.reload()
                                    }
                                })
                            }) : -15 == e.code ? TY.loader("TY.ui.nav",
                            function () {
                                TY.checkLoginUser(3)
                            }) : TY.loader("Qing.ui.tips",
                            function () {
                                new TY.ui.tips({
                                    type: "warn",
                                    msg: e.message,
                                    position: "midCenter",
                                    time: 3e3
                                })
                            })
                        }
                    })
                },
                isMod: !0
            })
        },
        delFromBlack: function (e) {
            var t = ['<div style="width:250px;height:40px;">', '<p style="text-align:center">确认将【' + oHomeInfo.userName + "】从黑名单中解除？</p>", "</div>"].join("");
            new TY.ui.pop({
                headTxt: "提示",
                type: "confirm",
                body: t,
                yesHandler: function () {
                    jQuery.ajax({
                        url: iceURL,
                        data: {
                            method: "userBlack.ice.delete",
                            "params.blackUserIds": e.attr("_data")
                        },
                        type: "POST",
                        dataType: "json",
                        cache: !1,
                        success: function (e) {
                            e && 1 == e.success && TY.loader("Qing.ui.tips",
                            function () {
                                new TY.ui.tips({
                                    type: "success",
                                    msg: "已将用户从黑名单解除。",
                                    position: "midCenter",
                                    time: 3e3,
                                    callback: function () {
                                        location.reload()
                                    }
                                })
                            })
                        }
                    })
                },
                isMod: !0
            })
        }
    };
    TUI.ifMod("#hd .header-profile",
    function (e) {
        t.listen(e)
    }),
    TUI.ifMod("#home_wrapper .module-userinfo .portrait",
    function (e) {
        t.listen(e)
    }),
    TUI.ifMod("#hd .toreward", TUI.toReward),
    e.init(),
    TUI.ifMod("#hd .oper-bar",
    function (e) {
        e.find(".t-notfocus").livequery(function () {
            jQuery(this).text("加关注")
        }),
        e.find(".t-focused").livequery(function () {
            jQuery(this).text("已加关注")
        }),
        e.find(".t-friend").livequery(function () {
            jQuery(this).text("已加好友"),
            jQuery(this).removeClass("t-setfocus"),
            e.find(".addtofriend").remove()
        })
    }),
    TUI.ifMod("#user_photo", TUI.loadHomePageImg),
    TUI.run(TUI.getModTotalNum),
    TUI.run(TUI.getNavTotalNum);
    var i = jQuery,
    a = window.oHomeInfo && oHomeInfo.userId || __global.getUserId();
    "undefined" != typeof bbsLazyLoad && 0 == bbsLazyLoad ? i.getScript("http://www.tianya.cn/api/bbsuser?" + i.param({
        "var": "bbsUser",
        method: "userinfo.ice.getUserTotalList",
        "params.userId": a
    }),
    function () {
        if (window.bbsUser && 1 == window.bbsUser.success && "" != window.bbsUser.data.list) {
            var e = [],
            t = [],
            n = window.bbsUser.data.list;
            t.push('<div class="home-module module-userbbs"><div class="mod-hd"><strong class="title">' + oHomeInfo.who + '的帖子</strong><span class="subtitle"><a href="http://www.tianya.cn/' + a + '/bbs?t=post" target="_blank">主帖' + window.bbsUser.data.compose + '</a>　<a href="http://www.tianya.cn/' + a + '/bbs?t=reply" target="_blank">回帖' + window.bbsUser.data.reply + '</a></span><a class="more" href="http://www.tianya.cn/' + a + '/bbs">更多</a></div><div class="mod-bd"><table class="posts"><tr class="th-row"><th class="p-title">帖子名</th><th class="p-block">版块</th><th class="p-time">时间</th></tr></table></div><div class="mod-ft"></div></div>');
            for (var o = 0; o < n.length; o++) e.push('<tr><td class="p-title"><a href="' + n[o].url + '" target="_blank" title="点击：' + n[o].clickCount + "&#10;回复：" + n[o].replyCount + '">' + n[o].title + '</a></td><td><a href="http://bbs.tianya.cn/list-' + n[o].categoryId + '-1.shtml" target="_blank">' + n[o].categoryName + "</a></td><td>" + n[o].time + "</td></tr>");
            i(".main-area").prepend(t.join("")),
            i(".module-userbbs").find(".th-row").after(e.join(""))
        }
    }) : TUI.ifMod("#user_bbs", TUI.userBBS),
    TUI.ifMod("#user_shang", TUI.userShang)
}),
TUI.loadHomePageImg = function (e) {
    var t = jQuery,
    i = oHomeInfo.userId == __global.getUserId() ? "http://photo.tianya.cn/gallery?act=getuserphoto&pn=1&ps=6" : "http://photo.tianya.cn/other/gallery?act=getuserphoto&uid=" + oHomeInfo.userId + "&pn=1&ps=6";
    t.getScript(i + "&var=rtnData",
    function () {
        if (1 == rtnData.result) {
            var t = rtnData.data.photoids;
            if (t.length > 0) {
                for (var i, a = e.find(".photo-list"), n = [], o = 0; o < t.length; o++) i = t[o],
                n.push('<li><a href="http://www.tianya.cn/' + oHomeInfo.userId + "/photo/" + i + '"><img src="http://img3.laibafile.cn/p/s/' + i + '.jpg"></a></li>');
                a.html(n.join("")),
                e.show()
            }
        }
    })
},
TUI.sendMessage = function () {
    var e = jQuery,
    t = e(".module-userinfo .sendmessage"),
    i = t.find(".textarea"),
    a = t.find(".toolbar .emotion"),
    n = t.find(".toolbar .photo"),
    o = t.find(".toolbar .gift"),
    s = t.find(".toolbar .hongbao"),
    r = t.find(".toolbar .pay-msg"),
    d = t.find(".sendmsg-btn"),
    l = {
        init: function () {
            this.bindEvent()
        },
        showTips: function (e, t, a) {
            TY.loader("Qing.ui.tips",
            function () {
                new TY.ui.tips({
                    el: i,
                    position: "midCenter",
                    type: e,
                    msg: t,
                    time: a || 2e3
                })
            })
        },
        vCode: function (t) {
            new TY.ui.pop({
                headTxt: "验证码",
                body: ['<p class="vcode-tips">' + t + "</p>", '<div id="msg_vcode" class="clearfix">', '<input type="text" id="vcode_ipt" maxlength="4" placeholder="请输入验证码" />', '<img id="vcode_img" src="http://imgcode.tianya.cn/services/ImageCodeService?_r=' + (new Date).getTime() + '" />', '<a id="vcode_change" href="javascript:void(0);">换一张</a>', "</div>"].join(""),
                render: function () {
                    e("#vcode_change").bind("click",
                    function () {
                        e("#vcode_img").attr("src", "http://imgcode.tianya.cn/services/ImageCodeService?_r=" + (new Date).getTime()),
                        e("#vcode_ipt").val("")
                    })
                },
                yesHandler: function () {
                    d.triggerHandler("click")
                }
            })
        },
        sendAction: function (t, a, n) {
            var o = this;
            e.post("http://www.tianya.cn/api/msg?method=messageuser.insertmessageforweb", {
                "params.receiveUserId": t,
                "params.content": a,
                "params.behavior": e("#user_action").val() || "",
                "params.code": n,
                "params.sourceName": "个人主页"
            },
            function (a) {
                1 == a.code && 1 == a.success ? (o.showTips("success", "发送消息成功"), e(".sendmsg-btn").text("发送"), i.val("")) : -2 == a.code ? o.vCode("您操作得太快了，请向我们证明您不是机器人？") : -3 == a.code ? o.vCode("验证码错误，请重新输入") : -4 == a.code ? TY_Common_util.showTips("warn", '您的操作速度太快，系统判断您为机器人，如误判请联系<a href="http://service.tianya.cn/" target="_blank">天涯客服</a>。', 5e3) : -15 == a.code ? TY.loader("TY.ui.nav",
                function () {
                    TY.checkLoginUser(3)
                }) : -401 == a.code ? o.showTips("info", '<span class="t-setfocus t-notfocus" _data="' + t + '" style="text-decoration:underline;color:#2965b1;">加关注</span>，才能进行更深入的交流喔。。', -1) : -403 == a.code ? o.showTips("info", '主人设置了<span class="fred">拒收陌生人站短消息</span>的权限<br />您可以通过<a class="q_addFriend" uid="' + t + '" uname="' + oHomeInfo.userName + '" style="text-decoration:underline;">加好友</a>与主人联系', -1) : o.showTips("warn", a.message || "发送消息失败")
            },
            "json")
        },
        bindEvent: function () {
            var t = this;
            a.bind("click",
            function () {
                TY.loader("TY.ui.faceV2",
                function () {
                    new TY.ui.Face({
                        el: a,
                        textArea: i,
                        isArrow: !1,
                        left: -15,
                        top: -290
                    })
                })
            }),
            TY.loader("TY.util.ajaxupload",
            function () {
                var a = new TY.util.AjaxUpload(n, {
                    action: "http://chat.tianya.cn/api/chatPostImage",
                    name: "sendMsgPhoto",
                    onSubmit: function (e, i) {
                        return /(jpg|png)$/.test(i.toLowerCase()) ? (a.setData({
                            fromWeb: 1,
                            receiveUserId: oHomeInfo.userId
                        }), void t.showTips("loading", "图片发送中", 999999)) : (t.showTips("warn", "只能发送jpg、png格式的图片", 3e3), !1)
                    },
                    onComplete: function (a, n) {
                        var o = e.parseJSON(n);
                        1 == o.code && 1 == o.success ? (t.showTips("success", "发送图片成功"), i.val("")) : t.showTips("warn", o.message || "发送图片失败")
                    }
                })
            }),
            o.bind("click",
            function () {
                var t = new TY.ui.pop({
                    headTxt: "赠送礼物",
                    body: '<iframe frameborder="0" scrolling="no" id="app_gift" name="app_gift" src="http://apps.tianya.cn/gift/presentselect.php?sendnames=@' + oHomeInfo.userName + '"></iframe>',
                    isShowButton: !1
                });
                window.objReSize || (window.giftReSize = function (i, a) {
                    e("#app_gift").css({
                        width: i,
                        height: a
                    }),
                    t.popPosHandler()
                }),
                window.closeGiftWindow || (window.closeGiftWindow = function () {
                    t.remove()
                })
            }),
            s.bind("click",
            function () {
                TY.loader("TY.ui.hongbao",
                function () {
                    TY.ui.hongbao.init({
                        width: 583,
                        data: {
                            action: "redpacket_u2u_pop",
                            from: "msg",
                            merId: "msg",
                            merMark: __global.getUserId() + "-" + oHomeInfo.userId,
                            toUserId: oHomeInfo.userId,
                            toUserName: oHomeInfo.userName
                        }
                    })
                })
            }),
            r.bind("click",
            function () {
                e.getScript("http://paidinfo.tianya.cn/api/call.do?method=paidinfo.user.isWhiteUser&var=whiteUser",
                function () {
                    var t = window.whiteUser;
                    if (t && 1 == t.success) if (1 == t.data.isWhiteUser) TY.loader("TY.ui.msgPay",
                    function () {
                        new TY.ui.msgPay({
                            uid: oHomeInfo.userId,
                            callback: function () { }
                        })
                    });
                    else var i = new TY.ui.pop({
                        isShowHead: !1,
                        isShowButton: !1,
                        isPadding: !1,
                        isDrag: !1,
                        body: ['<div id="message_pop">', '<div class="title"><h4>提示</h4><a class="close-btn closeBtn" href="javascript:void(0);" title="关闭"></a></div>', '<div class="content">', '<p class="text">您尚未开通付费作者权限，请前往帖子<br /><a href="http://bbs.tianya.cn/post-lookout-519852-1.shtml" target="_blank">天涯付费看付费作者申请帖</a> 申请！</p>', '<div class="button"><a class="confirm-btn" href="javascript:void(0);">确定</a></div>', "</div>", "</div>"].join(""),
                        render: function () {
                            e("#message_pop .confirm-btn").bind("click",
                            function () {
                                window.open("http://bbs.tianya.cn/post-lookout-519852-1.shtml"),
                                i.remove()
                            })
                        }
                    })
                })
            }),
            d.bind("click",
            function () {
                if (__global.isOnline()) {
                    var a = e.trim(i.val()),
                    n = e.trim(e("#vcode_ipt").val());
                    a ? (e(".sendmsg-btn").text("发送中"), t.sendAction(oHomeInfo.userId, a, n)) : t.showTips("info", "不写点什么吗？:)")
                } else TY.loginAction()
            })
        }
    };
    __global.isOnline() ? TY.loader("TY.util.userAction",
    function () {
        l.init()
    }) : (i.bind("focus",
    function () {
        TY.loginAction()
    }), d.addClass("disabled"))
},
TUI.userBBS = function (e) {
    var t = jQuery,
    i = window.oHomeInfo && oHomeInfo.userId || __global.getUserId(),
    a = function () {
        t.getScript("http://www.tianya.cn/api/bbsuser?method=userinfo.ice.getUserTotalArticleList&params.userId=" + i + "&params.pageSize=5&params.bMore=true&params.kindId=-1&var=UserTotalPostList",
        function () {
            var t = window.UserTotalPostList;
            if (t && 1 == t.success) {
                var i = t.data.rows || [],
                a = [];
                if (i.length > 0) {
                    for (var n, o = 0; o < i.length; o++) n = i[o],
                    a.push('<tr><td class="p-title"><a title="' + n.title + '" href="http://bbs.tianya.cn/post-' + n.item + "-" + n.art_id + '-1.shtml" target="_blank">' + n.title + "</a></td><td>" + n.click_counter + "/" + n.reply_counter + '</td><td><a title="' + n.item_name + '" href="http://bbs.tianya.cn/list-' + n.item + '-1.shtml" target="_blank">' + n.item_name + "</td><td>" + n.compose_time.substring(0, 10) + "</td></tr>");
                    e.find(".l-post .tips-row").remove(),
                    e.find(".l-post").append(a.join(""))
                } else e.find(".l-post .tips-row .loading").attr("class", "error").text("没有数据")
            } else e.find(".l-post .tips-row .loading").attr("class", "error").html('服务器开小差了（<a href="javascript:void(0);" class="post-refresh">刷新一下</a>）')
        })
    },
    n = function () {
        t.getScript("http://www.tianya.cn/api/bbsuser?method=userinfo.ice.getUserTotalReplyList&params.userId=" + i + "&params.pageSize=5&params.bMore=true&params.kindId=-1&var=UserTotalReplyList",
        function () {
            var t = window.UserTotalReplyList;
            if (t && 1 == t.success) {
                var i = t.data.rows || [],
                a = [];
                if (i.length > 0) {
                    for (var n, o = 0; o < i.length; o++) n = i[o],
                    a.push('<tr><td class="p-title"><a title="' + n.title + '" href="http://bbs.tianya.cn/go_reply_position.jsp?item=' + n.item + "&id=" + n.art_id + "&rid=" + n.reply_id + '" target="_blank">' + n.title + "</a></td><td>" + n.click_counter + "/" + n.reply_counter + '</td><td><a title="' + n.item_name + '" href="http://bbs.tianya.cn/list-' + n.item + '-1.shtml" target="_blank">' + n.item_name + "</td><td>" + n.reply_time.substring(0, 10) + "</td></tr>");
                    e.find(".l-reply .tips-row").remove(),
                    e.find(".l-reply").append(a.join(""))
                } else e.find(".l-reply .tips-row .loading").attr("class", "error").text("没有数据")
            } else e.find(".l-reply .tips-row .loading").attr("class", "error").html('服务器开小差了（<a href="javascript:void(0);" class="reply-refresh">刷新一下</a>）')
        })
    };
    e.delegate(".post-refresh", "click",
    function () {
        t(this).parent().html("").attr("class", "loading"),
        a()
    }),
    e.delegate(".reply-refresh", "click",
    function () {
        t(this).parent().html("").attr("class", "loading"),
        n()
    }),
    a(),
    n()
},
TUI.changeAttentionList = function (e) {
    var t = jQuery,
    i = e.find(".more"),
    a = window.oHomeInfo && oHomeInfo.userId || __global.getUserId(),
    n = function () {
        t.getScript("http://www.tianya.cn/api/tw?" + t.param({
            "var": "Interested",
            method: "following.ice.select",
            "params.userId": a,
            "params.pageSize": 2,
            "params.pageNo": +i.attr("_pn") + 1 || 1
        }),
        function () {
            if (window.Interested && 1 == window.Interested.success && window.Interested.data.user) {
                var i = [],
                a = window.Interested.data.user; (2 == window.Interested.data.total || window.Interested.data.total / 2 <= Interested.data.pageNo) && e.find(".more").hide();
                for (var n = 0; n < a.length; n++) i.push('<li class="clearfix"><div class="pic"><a title="' + a[n].name + '" href="http://www.tianya.cn/' + a[n].id + '"><img src="http://tx.tianyaui.com/logo/small/' + a[n].id + '" alt="' + a[n].name + '"></a></div><div class="text"><p class="name"><a title="' + a[n].name + '" href="http://www.tianya.cn/' + a[n].id + '">' + a[n].name + '</a></p><p class="desc" title="' + a[n].stardesc + '">' + a[n].stardesc + '</p></div><a class="fn addtofocus t-setfocus" href="javascript:void(0);" _data="' + a[n].id + '">加关注</a></li>');
                e.find(".more").attr({
                    _pn: Interested.data.pageNo
                }),
                "none" == e.css("display") ? 0 == a.length ? t(".user-attention").hide() : (e.find(".mod-bd ul").html(i.join("")), e.show()) : e.find(".mod-bd ul").fadeOut("fast",
                function () {
                    t(this).html(i.join("")).fadeIn()
                })
            }
        })
    };
    e.find(".more").live("click",
    function (e) {
        e.preventDefault(),
        n()
    }),
    n(),
    e.find(".t-notfocus").livequery(function () {
        jQuery(this).text("加关注")
    }),
    e.find(".t-focused").livequery(function () {
        jQuery(this).text("已关注")
    })
},
TUI.userShopList = function (e) {
    var t = jQuery,
    i = window.oHomeInfo && oHomeInfo.userId || __global.getUserId(),
    a = function () {
        t.getScript("http://shop.tianya.cn/api/getMerchantInfoByUserId?" + t.param({
            "var": "shopInfo",
            userIdWriter: i
        }),
        function () {
            if (1 == shopInfo.ifSuc && shopInfo) {
                var t = [],
                i = shopInfo.data;
                t.push('<li class="clearfix"><div class="pic"><a title="' + i.merchantName + '" href="' + i.merchantUrl + '"><img src="' + i.merchantLogoUrl + '" alt="' + i.merchantUrl + '"></a></div><div class="text"><p class="name"><a title="' + i.merchantName + '" href="' + i.merchantUrl + '">' + i.merchantName + '</a></p><p class="desc" title="' + i.merchantName + '">' + i.introduction + '</p></div><a class="fn go-shop" target="_blank" href="' + i.merchantUrl + '">进店</a></li>'),
                "none" == e.css("display") && (e.find(".mod-bd ul").html(t.join("")), e.show())
            } else e.remove()
        })
    };
    a()
},
TUI.userGoods = function (e) {
    var t = jQuery,
    i = window.oHomeInfo && oHomeInfo.userId || __global.getUserId(),
    a = function () {
        t.getScript("http://shop.tianya.cn/api/getProductListByUserId?" + t.param({
            "var": "goodsInfo",
            num: "4",
            userIdWriter: i
        }),
        function () {
            if (1 == goodsInfo.ifSuc && goodsInfo) {
                var i = [],
                a = goodsInfo.data.data;
                t(".module-usergoods .mod-hd .more").attr("href", goodsInfo.data.merchantUrl);
                for (var n = 0; n < a.length; n++) i.push('<li><a class="goods-item-inner" href="' + a[n].productUrl + '" target="_blank"><img src="' + a[n].productPicUrl + '"></a><p class="commodity-name"><a target="_blank" href="' + a[n].productUrl + '" title="' + a[n].productName + '">' + a[n].productName + '</a></p><div class="price-wrapper"><span class="commodity-price">￥' + a[n].presentPrice + '</span><span class="pre-price">￥' + a[n].originalPrice + '</span><a href="' + a[n].productUrl + '" class="btn-buy" target="_blank">抢购</a></div></li>');
                "none" == e.css("display") && (e.find(".mod-bd ul").html(i.join("")), e.show())
            } else e.remove()
        })
    };
    a()
},
TUI.userShang = function (e) {
    var t = jQuery,
    i = e.find(".tabs a");
    i.bind("click",
    function () {
        var i = t(this).attr("_type");
        t(this).hasClass("active") || (t(this).addClass("active").siblings().removeClass("active"), e.find(".tabs-content[_type='" + i + "']").show().siblings().hide())
    }),
    i.eq(0).triggerHandler("click")
},
TUI.getModTotalNum = function () {
    var e = jQuery,
    t = window.oHomeInfo && oHomeInfo.userId || __global.getUserId(),
    i = {
        photo_other: "http://photo.tianya.cn/other/gallery?act=getphotocount&var=PhotoNum",
        photo_my: "http://photo.tianya.cn/gallery?act=getphotocount&var=PhotoNum",
        bbs: "http://www.tianya.cn/api/tw?method=userinfo.ice.selectComposeCount&var=BbsNum",
        activity: "http://www.tianya.cn/api/tw?method=twittercount.ice.select&var=ActivityNum"
    },
    a = function (a) {
        var n = "";
        n = __global.getUserId() == t ? i.photo_my : i.photo_other,
        e.getScript(n + "&" + e.param({
            uid: t
        }),
        function () {
            var e = window.PhotoNum;
            if (e && e.data && !isNaN(+e.data.count)) {
                var i = +e.data.count;
                i && a.html('（<a href="http://www.tianya.cn/' + t + '/photo/page/1">' + i + "</a>）")
            }
        })
    },
    n = function (a) {
        e.getScript(i.bbs + "&" + e.param({
            "params.userId": t
        }),
        function () {
            var e = window.BbsNum;
            if (e && 1 == e.code && 1 == e.success && e.data) {
                var i = +e.data.compose,
                n = +e.data.reply;
                i && a.find("#total_num_post").html('（<a href="http://www.tianya.cn/' + t + '/bbs">' + i + "</a>）"),
                n && a.find("#total_num_reply").html('（<a href="http://www.tianya.cn/' + t + '/bbs">' + n + "</a>）")
            }
        })
    },
    o = function (a) {
        e.getScript(i.activity + "&" + e.param({
            "params.userId": t
        }),
        function () {
            var e = window.ActivityNum;
            if (e && 1 == e.code && 1 == e.success && e.data) {
                var i = +e.data.tweetCount;
                i && a.html('（<a href="http://www.tianya.cn/' + t + '/t">' + i + "</a>）")
            }
        })
    };
    TUI.ifMod("#total_num_photo", a),
    TUI.ifMod("#user_bbs", n),
    TUI.ifMod("#total_num_activity", o)
},
TUI.toReward = function (e) {
    var t = window.rewardKey || {};
    e.bind("click",
    function () {
        __global.isOnline() ? TY.loader("TY.ui.dashang",
        function () {
            TY.ui.dashang.init({
                src: "http://shang.tianya.cn/order/index.do?merId=" + encodeURIComponent(t.merId) + "&merNum=" + t.merNum + "&getName=" + encodeURIComponent(t.getName) + "&time=" + t.time + "&sign=" + t.sign
            })
        }) : TY.loginAction()
    })
},
TUI.getNavTotalNum = function () {
    var e = jQuery,
    t = __global.getUserId();
    if (t) {
        var i = {
            album: "http://photo.tianya.cn/gallery?act=getphotocount&var=PhotoNum&uid=" + t,
            wenda: "http://wenda.tianya.cn/userinfo?action=show&var=WendaNum&userId=" + t,
            weilun: "http://groups.tianya.cn/api?method=group.user.getUserAllItem&var=newGroup",
            blog: "http://blog.tianya.cn/blog/blog_userpostnum.jsp?userId=" + t
        },
        a = function (e) {
            return e > 99999 ? "9999+" : e
        },
        n = function (t) {
            e.getScript(i.album,
            function () {
                var e = window.PhotoNum;
                if (e && e.data && !isNaN(+e.data.count)) {
                    var i = a(+e.data.count);
                    i && t.html("(" + i + ")")
                }
            })
        },
        o = function (t) {
            e.getScript(i.wenda,
            function () {
                if (window.WendaNum && "success" == WendaNum.result) {
                    var e = a(+WendaNum.data.user.topicCount);
                    e && t.html("(" + e + ")")
                }
            })
        },
        s = function (t) {
            e.getScript(i.weilun,
            function () {
                if (window.newGroup && newGroup.data.total) {
                    var e = a(+newGroup.data.total);
                    e && t.html("(" + e + ")")
                }
            })
        },
        r = function (t) {
            e.getScript(i.blog,
            function () {
                if (window.profileInitInfo && profileInitInfo.totalBlogs) {
                    var e = a(+profileInitInfo.totalBlogs);
                    e && t.html("(" + e + ")")
                }
            })
        };
        window.profileInitInfo = {},
        TUI.ifMod("#left_nav .album .num", n),
        TUI.ifMod("#left_nav .wenda .num", o),
        TUI.ifMod("#left_nav .weilun .num", s),
        TUI.ifMod("#left_nav .blog .num", r)
    }
},
function (e) {
    function t() {
        var t = e("#home_wrapper .module-userinfo");
        e.browser.msie && 6 == e.browser.version || (e(window).bind("scroll",
        function () {
            var i = e(document).height() - t.outerHeight() - 107,
            a = 73,
            n = e(window).height() - t.outerHeight() - 100 < 0 ? !0 : !1,
            o = e(window).scrollTop();
            return 0 > i || 107 > i ? void ((t.data("fixed") || t.data("absolute")) && (t.data("fixed", !1).data("absolute", !1), t.css({
                position: "relative",
                top: 0
            }))) : void (o > a ? i > o ? t.data("fixed") || (t.data("fixed", !0).data("absolute", !1), t.css({
                position: "fixed",
                top: 0
            })) : n ? t.data("absolute") || (t.data("fixed", !1).data("absolute", !0), t.css({
                position: "absolute",
                top: i
            })) : t.data("fixed") || (t.data("fixed", !0).data("absolute", !1), t.css({
                position: "fixed",
                top: 0
            })) : (t.data("fixed") || t.data("absolute")) && (t.data("fixed", !1).data("absolute", !1), t.css({
                position: "relative",
                top: 0
            })))
        }), e(window).triggerHandler("scroll"))
    }
    function i() {
        var t = e("#home_wrapper .main-area"),
        i = e(".module-userinfo .timeline-open");
        i.bind("click",
        function () {
            i.hide(),
            scroll(0, 0),
            t.children().fadeOut(),
            e(".moudle-timeline").size() ? (e(".moudle-timeline").attr("class", "moudle-timeline animated slideInLeft"), e(".moudle-timeline").show()) : (t.append(['<div class="moudle-timeline animated slideInLeft">', '<a class="timeline-close pngfix" href="javascript:void(0);">关闭时间隧道</a>', '<div id="suiji_timeline" data-regtime="' + oHomeInfo.regTime + '"></div>', "</div>"].join("")), Time_Line.init({
                container: e("#suiji_timeline")
            }))
        }),
        t.delegate(".timeline-close", "click",
        function () {
            e(".moudle-timeline").attr("class", "moudle-timeline animated slideOutLeft"),
            setTimeout(function () {
                e(".moudle-timeline").hide(),
                t.children(":not('.moudle-timeline')").fadeIn(),
                i.show()
            },
            500)
        })
    }
    function a(t) {
        var i = function () {
            e.getJSON("http://www.tianya.cn/api/tw?method=tweet.ice.selectFeedByUser&" + e.param({
                "params.filterTwitter": 1,
                "params.filterQing": 1,
                "params.filterBbs": 1,
                "params.filterBlog": 1,
                "params.filterOwn": 1,
                "params.userId": oHomeInfo.userId,
                "params.pageSize": 2,
                "params.pageNo": 1,
                "params.page": 1,
                "params.filterGroups": 1,
                "params.lastTime": (new Date).getTime()
            }),
            function (i) {
                if (i && 1 == i.success) {
                    var a = i.data.items,
                    n = i.data.total;
                    if (n) {
                        e(".module-usersuiji").show();
                        for (var o = [], s = 0; s < a.length; s++) o.push(SuiJi_template.UserFeedItemTpl(a[s]));
                        e(".sj-feed-content").append(o.join("")),
                        SuiJi_operation.changeCollectBtnState(),
                        SuiJi_operation.changePraiseBtnState()
                    } else if (t.remove(), e(".module-userinfo .timeline-open").remove(), !(e(".module-usershang").size() || e(".module-userweilun").size() || e(".module-userblog").size() || e("#manager_link").size() || e(".module-userbook").size() || e(".module-userread").size() || e(".module-userwenda").size() || e(".module-usergoods").size())) if (e(".module-userbbs").size()) {
                        if (postDatas && postDatas.length) {
                            for (var r, d = "",
                            s = 0; s < postDatas.length; s++) r = postDatas[s],
                            d += ["<tr>", '<td class="p-title"><a href="http://bbs.tianya.cn/post-' + r.categoryId + "-" + r.articleId + '-1.shtml" title="点击：' + r.clickCount + "&#10;回复：" + r.replyCount + '" target="_blank">' + r.title + "</a></td>", '<td><a href="http://bbs.tianya.cn/list-' + r.categoryId + '-1.shtml" title="' + r.categoryName + '" target="_blank">' + r.categoryName + "</a></td>", "<td>" + r.time.substring(0, 16) + "</td>", "</tr>"].join("");
                            e(".module-userbbs .posts").find("tr:last").after(d)
                        }
                        e(".module-userbbs").height(""),
                        e(".module-userbbs").height() < e(".module-userinfo").height() && e(".module-userbbs").height(e(".module-userinfo").height())
                    } else e("#home_wrapper .main-area").html(['<div class="moudle-notrace">', '<div class="notrace"><p>天涯没有留下' + oHomeInfo.who + "的任何痕迹<br />但是" + oHomeInfo.who + "已经飞过……</p></div>", "</div>"].join("")),
                    e(".moudle-notrace").height() < e(".module-userinfo").height() && e(".moudle-notrace").height(e(".module-userinfo").height())
                }
            })
        };
        TY.loader("TY.view.artTemplate", "TY.util.cursorPoint",
        function () {
            t.find(".mod-hd .more").bind("click",
            function () {
                e(".timeline-open").triggerHandler("click")
            }),
            SuiJi_template.init(),
            t.find("#suiji_others_container").append(SuiJi_template.FeedContentTpl()),
            SuiJi_operation.init({
                container: e(".sj-feed-content")
            }),
            i()
        })
    }
    function n(t) {
        e.getScript("http://game.tianya.cn/api/call.do?method=game.server.gameUserLogin&" + e.param({
            pageSize: "3",
            userId: oHomeInfo.userId,
            "var": "UserGames"
        }),
        function () {
            if (window.UserGames && 1 == UserGames.success) {
                var e = UserGames.data.items || [],
                i = "";
                if (e.length) {
                    for (var a = 0; a < e.length; a++) i += '<li><a href="' + e[a].serverLink + '" target="_blank"><img title="' + e[a].gameName + '" alt="' + e[a].gameName + '" src="' + e[a].gameImg + '"></a></li>';
                    t.find(".gamelist").html(i),
                    t.show()
                }
            }
        })
    }
    function o() {
        e(".flexslider").flexslider({
            animation: "slide",
            slideshowSpeed: 3e3,
            animationLoop: !0,
            itemWidth: 100,
            itemMargin: 10,
            minItems: 1,
            maxItems: 6
        }),
        e(".slides li").length < 7 ? e(".flex-direction-nav,.flex-control-paging").hide() : e(".flex-direction-nav,.flex-control-paging").show()
    }
    function s() {
        jQuery.getScript("http://www.tianya.cn/api/tw?var=niuService&method=userinfo.ice.queryUserVipInfo&params.userId=" + oHomeInfo.userId + "&params.opType=12",
        function () {
            if (1 == niuService.success && 1 == niuService.data.vipInfo.isGenius && 1 == niuService.code) {
                var e = niuService.data.vipInfo.data,
                t = 1,
                i = "";
                for (var a in e) {
                    var n = e[a].title,
                    o = e[a].level,
                    s = jQuery("#home_wrapper .portrait .medal");
                    n = n.replace(/\,/g, "&#10;"),
                    t > 1 && (i = "&nbsp;"),
                    t++,
                    3 == o ? s.prepend('<a class="niu niu-gold" href="javascript:void(0)" title="' + n + '" target="_blank"></a>' + i) : 2 == o ? s.prepend('<a class="niu niu-silver" href="javascript:void(0)" title="' + n + '" target="_blank"></a>' + i) : 1 == o && s.prepend('<a class="niu niu-copper" href="javascript:void(0)" title="' + n + '" target="_blank"></a>' + i)
                }
            }
        })
    }
    function r() {
        var e = oHomeInfo.userId;
        jQuery.getScript("http://www.tianya.cn/api/tw?var=jiaoService&method=userinfo.ice.queryUserVipInfo&params.userId=" + e + "&params.opType=17",
        function () {
            if (1 == jiaoService.success && 1 == jiaoService.code) {
                var e = jiaoService.data.vipInfo.level;
                switch (e) {
                    case 1:
                        jQuery("#home_wrapper .medal .jiao-v").addClass("icon-jiao-first"),
                        jQuery("#home_wrapper .medal .jiao-v").attr("title", "现货财主一级会员");
                        break;
                    case 2:
                        jQuery("#home_wrapper .medal .jiao-v").addClass("icon-jiao-second"),
                        jQuery("#home_wrapper .medal .jiao-v").attr("title", "现货财主二级会员")
                }
            } else jQuery("#home_wrapper .medal .jiao-v").remove()
        })
    }
    function d(t) {
        var i = oHomeInfo.userId;
        e.getScript("http://wenda.tianya.cn/wd_checkIfexpert.jsp?uid=" + i + "&var=expertObj",
        function () {
            if (!e.isEmptyObject(expertObj)) {
                var a = e("#introTxt"),
                n = e("#toggleBtn"),
                o = expertObj.summary,
                s = expertObj.relatePost,
                r = expertObj.price,
                d = o.length,
                l = 56,
                u = [];
                if (t.show(), u = r.split("."), "0" == u[1] && (r = u[0]), e("#shangPrice").html(r), d > l) {
                    var c = o.substring(0, l);
                    n.show(),
                    a.html(c + "..."),
                    n.toggle(function () {
                        a.html(o),
                        n.html("收起")
                    },
                    function () {
                        a.html(c + "..."),
                        n.html("展开")
                    })
                } else a.html(o)
            }
            e("#shangConsult").click(function () {
                window.location.href = "" !== s ? s : "http://wenda.tianya.cn/mentor/" + i
            })
        })
    }
    e(function () {
        __global.isOnline() || TY.loginAction(),
        TUI.ifMod("#home_wrapper .module-usersuiji", a),
        TUI.ifMod("#home_wrapper .module-usershang", TUI.userShang),
        TUI.ifMod("#home_wrapper .module-usergame", n),
        TUI.ifMod("#home_wrapper .module-usergoods", TUI.userGoods),
        TUI.ifMod("#home_wrapper .module-userweilun", o),
        TUI.ifMod("#home_wrapper .medal", s),
        TUI.ifMod("#home_wrapper .jiao-v", r),
        TUI.ifMod(".user-attention", TUI.changeAttentionList),
        TUI.ifMod(".user-shop", TUI.userShopList),
        e(".module-usersuiji").hide(),
        !e("#home_wrapper .module-userinfo").size() || e("#home_wrapper .user-attention").size() || e("#home_wrapper .user-tag").size() || e("#home_wrapper .user-shop").size() || t(),
        TUI.ifMod(".module-userinfo .timeline", i),
        TUI.ifMod(".module-userinfo .sendmessage", TUI.sendMessage),
        TUI.ifMod(".relate-oper .shang-btn", TUI.toReward),
        TUI.ifMod(".module-userinfo .expert-intro", d),
        e(".relate-oper").size() && (e(".relate-oper").find(".t-notfocus").livequery(function () {
            e(this).text("+ 关注")
        }), e(".relate-oper").find(".t-focused").livequery(function () {
            e(this).text("已加关注")
        }), e(".relate-oper").find(".t-friend").livequery(function () {
            e(this).text("已加好友"),
            e(this).siblings(".q_addFriend").remove()
        })),
        e("#huebox").css("min-height", e(window).height() - 60 + "px")
    })
}(jQuery);